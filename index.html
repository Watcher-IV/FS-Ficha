<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ficha Flagelo-Sombrio (Protótipo)</title>

  <!-- Fonts: Titulos, Texto e Numeros -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Spectral:wght@300;400;600&family=VT323&display=swap" rel="stylesheet">

  <style>
    /* -----------------------------
       CONFIGURAÇÕES GLOBAIS
       ----------------------------- */
    :root{
      --accent: #eaeaea;
      --accent-2: #7b0000;
      --muted: #bbbbbb;
      --bg-image: url('background-template.jpg');
      --portrait-normal: url('portrait_normal.png');
      --portrait-injured: url('portrait_injured.png');
      --portrait-insane: url('portrait_insane.png');
    }

    /* reset / box sizing */
    *{box-sizing:border-box;}
    html,body{height:100%;margin:0;padding:0;overflow:hidden;} /* page hides outer scroll as requested */
    body{
      font-family: 'Spectral', serif;
      background:#080808;
      color:var(--accent);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      font-size:14px; /* base scale */
    }

    /* Layout: três colunas */
    .wrap{
      display:grid;
      grid-template-columns: 240px 1fr 320px;
      gap:18px;
      padding:16px;
      height:100vh;
      align-items:start;
      min-width:0;
    }

    /* Painel esquerdo */
    .panel{
      background: rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.03);
      padding:12px;
      box-sizing:border-box;
      height:calc(100vh - 32px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .portrait{
      width:100%;
      height:360px;
      background-image:var(--portrait-normal);
      background-size:cover;
      background-position:center;
      border:1px solid rgba(255,255,255,0.04);
      margin-bottom:10px;
      flex-shrink:0;
    }

    .vitals{
      display:flex;
      gap:8px;
      align-items:flex-start;
      margin-bottom:10px;
    }

    .vital{
      flex:1;
      text-align:center;
      padding:8px 6px;
      border:1px dashed rgba(255,255,255,0.03);
      min-width:0;
    }

    .vital h4{font-family:'Cinzel Decorative', serif;margin:0 0 6px 0;font-size:14px;color:var(--accent);}
    .vital input[type=number]{width:100%;background:transparent;border:none;color:var(--accent);font-family:'VT323',monospace;font-size:20px;text-align:center}
    .vital .meta{font-size:11px;color:var(--muted);margin-top:6px}

    .small-btn{display:inline-block;padding:5px 7px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;margin-top:6px;font-size:12px}

    /* Efeitos (Buffs / Debuffs) */
    .effects{
      margin-top:8px;
      border-top:1px solid rgba(255,255,255,0.03);
      padding-top:8px;
      display:flex;flex-direction:column;gap:8px;
    }
    .effects-list{list-style:none;padding:0;margin:0;max-height:160px;overflow:auto}
    .effect-item{padding:6px;border-bottom:1px solid rgba(255,255,255,0.03);font-size:13px;display:flex;justify-content:space-between}
    .effects-add{display:flex;gap:8px}
    .effects-add input{flex:1;padding:6px}

    /* Centro: ficha (scrollável sem barra) */
    .center{
      background: rgba(0,0,0,0.6);
      padding:12px;
      box-sizing:border-box;
      height:calc(100vh - 32px);
      overflow:auto; /* scrollable invisível */
      -ms-overflow-style: none;  /* IE/Edge */
      scrollbar-width: none;  /* Firefox */
    }
    .center::-webkit-scrollbar{display:none;} /* Chrome/Safari */

    .title-wrap{display:flex;justify-content:center;margin-bottom:10px}
    .title{font-family:'Cinzel Decorative', serif;font-size:22px}

    /* Informações pessoais (estilo ficha) */
    .personal{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px}
    .personal input{width:100%;padding:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);font-size:13px}

    /* Grid de atributos */
    .attrs{margin-top:6px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .attr{padding:10px;border:1px solid rgba(255,255,255,0.04);min-width:0}
    .attr h5{margin:0 0 6px 0;font-size:12px;color:var(--muted)}
    .attr .controls{display:flex;align-items:center;gap:6px}
    .attr .val{font-family:'VT323', monospace;font-size:18px;width:42px;text-align:center}
    .attr button{padding:5px 7px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;font-size:12px}

    /* Perícias / Habilidades - duas colunas */
    .skill-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .skill-box{border:1px solid rgba(255,255,255,0.04);padding:8px}
    .skill-box textarea{min-height:120px}

    /* Condições / Características (grande caixa) */
    .conditions{margin-top:12px}
    .conditions textarea{min-height:220px}

    /* Painel direito - inventário avançado */
    .inventory{
      background: rgba(0,0,0,0.6);
      padding:12px;
      box-sizing:border-box;
      height:calc(100vh - 32px);
      overflow:hidden;
      display:flex;flex-direction:column;
    }
    .inv-list{list-style:none;padding:0;margin:0;flex:1 1 auto;overflow:auto}
    .inv-item{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);font-size:13px;display:flex;justify-content:space-between;gap:8px}
    .inv-item .left{flex:1}
    .inv-item .meta{min-width:68px;text-align:right;color:var(--muted);font-size:13px}

    .inv-add{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:8px;margin-top:8px}
    .inv-add input, .inv-add textarea{padding:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent);font-size:13px}
    .inv-add button{padding:6px 8px}

    /* hide scrollbar visuals for inv-list too */
    .inv-list::-webkit-scrollbar{display:none}
    .inv-list{scrollbar-width:none;-ms-overflow-style:none}

    /* small responsive tweaks */
    @media(max-width:1200px){
      .wrap{grid-template-columns:220px 1fr 280px}
      .portrait{height:320px}
      .title{font-size:20px}
    }
    @media(max-width:980px){
      html,body{overflow:auto;}
      .wrap{grid-template-columns:1fr;grid-auto-rows:min-content;padding:12px}
      .portrait{height:240px}
      .center{height:auto;overflow:visible}
      .inventory{height:auto;overflow:visible}
    }

    .hint{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">

    <!-- ESQUERDA: Painel Vital -->
    <aside class="panel">
      <div class="portrait" id="portrait" title="Retrato do personagem"></div>

      <div class="vitals">
        <div class="vital">
          <h4>PV</h4>
          <input type="number" id="pvInput" value="10" min="0" />
          <div class="meta">Max HP: <span id="hpMaxDisplay">10</span></div>
        </div>

        <div class="vital">
          <h4>PS</h4>
          <input type="number" id="psInput" value="50" min="0" />
        </div>

        <div class="vital">
          <h4>Tensão</h4>
          <input type="number" id="tensionInput" value="6" min="0" />
          <div class="meta">Calculado a partir de AUR (6 + AUR×2)</div>
        </div>
      </div>

      <div class="effects">
        <div style="font-size:13px;color:var(--muted)">Efeitos (Buffs / Debuffs)</div>
        <ul class="effects-list" id="effectsList"></ul>
        <div class="effects-add">
          <input id="effectName" placeholder="Nome do efeito (ex: +2 PV temporário)" />
          <button type="button" class="small-btn" id="effectAdd">+ adicionar</button>
        </div>
      </div>

    </aside>

    <!-- CENTRO: Ficha Principal -->
    <main class="center" id="centerPane">
      <div class="title-wrap"><div class="title">Ficha — Flagelo Sombrio</div></div>

      <div class="personal">
        <input id="nameField" placeholder="Nome" />
        <input id="originField" placeholder="Origem" />
        <input id="ageField" placeholder="Idade" />
        <input id="heightField" placeholder="Altura" />
        <input id="eyeField" placeholder="Cor dos olhos" />
        <div></div>
      </div>

      <div class="block">
        <label style="display:block;margin-bottom:8px;color:var(--muted)">Atributos (0 a 3)</label>
        <div class="attrs">
          <!-- FOR -->
          <div class="attr">
            <h5>FOR — Poder Físico</h5>
            <div class="controls">
              <button type="button" data-attr="FOR" class="attr-dec">-</button>
              <div class="val" id="FOR">0</div>
              <button type="button" data-attr="FOR" class="attr-inc">+</button>
            </div>
          </div>

          <!-- AGI -->
          <div class="attr">
            <h5>AGI — Velocidade e Precisão</h5>
            <div class="controls">
              <button type="button" data-attr="AGI" class="attr-dec">-</button>
              <div class="val" id="AGI">0</div>
              <button type="button" data-attr="AGI" class="attr-inc">+</button>
            </div>
          </div>

          <!-- VIG -->
          <div class="attr">
            <h5>VIG — Resistência Física</h5>
            <div class="controls">
              <button type="button" data-attr="VIG" class="attr-dec">-</button>
              <div class="val" id="VIG">0</div>
              <button type="button" data-attr="VIG" class="attr-inc">+</button>
            </div>
            <div style="font-size:12px;color:var(--muted);margin-top:8px">HP = 10 + (VIG × 3)</div>
          </div>

          <!-- INT -->
          <div class="attr">
            <h5>INT — Conhecimento e Lógica</h5>
            <div class="controls">
              <button type="button" data-attr="INT" class="attr-dec">-</button>
              <div class="val" id="INT">0</div>
              <button type="button" data-attr="INT" class="attr-inc">+</button>
            </div>
          </div>

          <!-- AUR -->
          <div class="attr">
            <h5>AUR — Energia Espiritual</h5>
            <div class="controls">
              <button type="button" data-attr="AUR" class="attr-dec">-</button>
              <div class="val" id="AUR">0</div>
              <button type="button" data-attr="AUR" class="attr-inc">+</button>
            </div>
            <div style="font-size:12px;color:var(--muted);margin-top:8px">Tensão = 6 + (AUR × 2) — mínimo 6, máximo 12</div>
          </div>

          <!-- CAR -->
          <div class="attr">
            <h5>CAR — Influência Social</h5>
            <div class="controls">
              <button type="button" data-attr="CAR" class="attr-dec">-</button>
              <div class="val" id="CAR">0</div>
              <button type="button" data-attr="CAR" class="attr-inc">+</button>
            </div>
          </div>
        </div>
      </div>

      <div class="skill-row">
        <div class="skill-box">
          <label style="display:block;margin-bottom:6px;color:var(--muted)">Perícias</label>
          <textarea id="skills" placeholder="Liste perícias (uma por linha)"></textarea>
        </div>
        <div class="skill-box">
          <label style="display:block;margin-bottom:6px;color:var(--muted)">Habilidades</label>
          <textarea id="abilities" placeholder="Liste habilidades (uma por linha)"></textarea>
        </div>
      </div>

      <div class="conditions">
        <label style="display:block;margin-bottom:6px;color:var(--muted)">Condições e Características</label>
        <textarea id="notes" placeholder="Condições, características e notas importantes"></textarea>
      </div>

    </main>

    <!-- DIREITA: Inventário -->
    <aside class="inventory">
      <h4 style="margin:0 0 8px 0;font-family:'Cinzel Decorative', serif;font-size:16px">Inventário</h4>
      <ul class="inv-list" id="invList"></ul>

      <div class="inv-add">
        <input id="invName" placeholder="Nome do item" />
        <input id="invQty" type="number" placeholder="Qtd" min="1" />
        <input id="invSpace" placeholder="Espaço/Tipo" />
        <button type="button" class="small-btn" id="invAddBtn">+ adicionar</button>
      </div>

      <div class="strange-msg" id="strangeMsg">"Você não consegue deixar de escutar algo..."</div>

    </aside>

  </div>

  <script>
    /* -----------------------------
       LOGICA INTERATIVA
       ----------------------------- */

    const state = {
      attrs: {FOR:0, AGI:0, VIG:0, INT:0, AUR:0, CAR:0},
      hpMax:10,
      pv:10,
      ps:50,
      tension:6,
      inventory:[],
      effects:[],
      manualTensionOverride:false
    };

    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    // DOM refs
    const FORel = document.getElementById('FOR');
    const AGIel = document.getElementById('AGI');
    const VIGel = document.getElementById('VIG');
    const INTel = document.getElementById('INT');
    const AURel = document.getElementById('AUR');
    const CARel = document.getElementById('CAR');

    const pvInput = document.getElementById('pvInput');
    const psInput = document.getElementById('psInput');
    const tensionInput = document.getElementById('tensionInput');
    const hpMaxDisplay = document.getElementById('hpMaxDisplay');

    const portrait = document.getElementById('portrait');
    const strangeMsg = document.getElementById('strangeMsg');

    const invList = document.getElementById('invList');
    const effectsList = document.getElementById('effectsList');

    const strangePool = [
      'Você ouviu o seu nome no silêncio.',
      'Algo escreve na margem do seu pensamento.',
      'Não confie no que a ficha mostra agora.',
      'O reflexo não combina mais com você.',
      'Você não parece tão digno de viver aqui.'
    ];

    // recalc: hpMax e tension (a menos que override manual)
    function recalcAll(){
      const vig = state.attrs.VIG;
      state.hpMax = 10 + (vig * 3);

      // tension auto-calc only if not overridden manually
      if(!state.manualTensionOverride){
        const aur = state.attrs.AUR;
        state.tension = clamp(6 + (aur * 2), 6, 12);
      }

      // ensure basic bounds for pv/ps
      state.pv = Math.max(0, Number(state.pv) || 0);
      state.ps = Math.max(0, Number(state.ps) || 0);

      renderAll();
    }

    function renderAll(){
      // attrs
      FORel.textContent = state.attrs.FOR;
      AGIel.textContent = state.attrs.AGI;
      VIGel.textContent = state.attrs.VIG;
      INTel.textContent = state.attrs.INT;
      AURel.textContent = state.attrs.AUR;
      CARel.textContent = state.attrs.CAR;

      // vitals
      pvInput.value = state.pv;
      psInput.value = state.ps;
      tensionInput.value = state.tension;
      hpMaxDisplay.textContent = state.hpMax;

      // logica do portrait 
      if(state.ps < 25){
        portrait.style.backgroundImage = "var(--portrait-insane)";
      } else if(Number(state.pv) < (state.hpMax/2)){
        portrait.style.backgroundImage = "var(--portrait-injured)";
      } else {
        portrait.style.backgroundImage = "var(--portrait-normal)";
      }

      // Mensagens estranhhas
      if(state.ps < 25){
        strangeMsg.style.display = 'block';
        strangeMsg.textContent = '"'+ strangePool[Math.floor(Math.random()*strangePool.length)] + '"';
      } else {
        strangeMsg.style.display = 'none';
      }

      renderInventory();
      renderEffects();
    }

    // Funções do Inventário
    function renderInventory(){
      invList.innerHTML = '';
      state.inventory.forEach((it, idx)=>{
        const li = document.createElement('li');
        li.className = 'inv-item';
        li.innerHTML = `
          <div class="left"><strong>${escapeHtml(it.name)}</strong><div style="font-size:12px;color:var(--muted)">${escapeHtml(it.space)}</div></div>
          <div class="meta">x${it.qty} <br><button type="button" data-idx='${idx}' class='small-btn inv-del'>remover</button></div>`;
        invList.appendChild(li);
      });
    }

    // effects
    function renderEffects(){
      effectsList.innerHTML = '';
      state.effects.forEach((ef, i)=>{
        const li = document.createElement('li');
        li.className = 'effect-item';
        li.innerHTML = `<div>${escapeHtml(ef)}</div><div><button type="button" data-idx='${i}' class='small-btn eff-del'>x</button></div>`;
        effectsList.appendChild(li);
      });
    }

    // helper escape
    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[m];});
    }

    // Botões de atributos
    document.querySelectorAll('.attr-inc').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const a = btn.getAttribute('data-attr');
        const curr = state.attrs[a];
        if(curr < 3){
          state.attrs[a] = curr + 1;
          // se AUR mudar, muda o estado da Tensão
          if(a === 'AUR') state.manualTensionOverride = false;
          recalcAll();
        }
      });
    });
    document.querySelectorAll('.attr-dec').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const a = btn.getAttribute('data-attr');
        const curr = state.attrs[a];
        if(curr > 0){
          state.attrs[a] = curr - 1;
          if(a === 'AUR') state.manualTensionOverride = false;
          recalcAll();
        }
      });
    });

    // inputs para PV / PS / Tensão
    pvInput.addEventListener('input', ()=>{ state.pv = pvInput.value === '' ? 0 : Number(pvInput.value); renderAll(); });
    psInput.addEventListener('input', ()=>{ state.ps = psInput.value === '' ? 0 : Number(psInput.value); renderAll(); });
    tensionInput.addEventListener('input', ()=>{ state.tension = tensionInput.value === '' ? 0 : Number(tensionInput.value); state.manualTensionOverride = true; renderAll(); });

    // inventario add/remove
    document.getElementById('invAddBtn').addEventListener('click', ()=>{
      const name = document.getElementById('invName').value.trim();
      const qty = Number(document.getElementById('invQty').value) || 1;
      const space = document.getElementById('invSpace').value.trim() || '';
      if(!name) return;
      state.inventory.push({name, qty, space});
      document.getElementById('invName').value = '';
      document.getElementById('invQty').value = '';
      document.getElementById('invSpace').value = '';
      renderAll();
    });

    invList.addEventListener('click', (e)=>{
      if(e.target.classList.contains('inv-del')){
        const idx = Number(e.target.getAttribute('data-idx'));
        state.inventory.splice(idx,1);
        renderAll();
      }
    });

    // efeito add/remove
    document.getElementById('effectAdd').addEventListener('click', ()=>{
      const name = document.getElementById('effectName').value.trim();
      if(!name) return;
      state.effects.push(name);
      document.getElementById('effectName').value = '';
      renderAll();
    });

    effectsList.addEventListener('click', (e)=>{
      if(e.target.classList.contains('eff-del')){
        const idx = Number(e.target.getAttribute('data-idx'));
        state.effects.splice(idx,1);
        renderAll();
      }
    });

    // init
    recalcAll();

  </script>
</body>
</html>
